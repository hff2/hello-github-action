name: Release
run-name: Test Close MileStone
on:
  milestone:
    types: [closed]

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Create release
      env:
          GITHUB_TOKEN: ${{ secrets.ACTION_TOKEN }}
      run: gh release create ${{ github.event.milestone.title }}
    - name: Install yq
      id: setup-yq
      uses: shiipou/setup-yq-action@v2.2.0
      
    - name: display yq result
      run: |
        echo $(yq .deploy.backend ./deploy/deploy.yml)

    - name: upload file
      env:
          GITHUB_TOKEN: ${{ secrets.ACTION_TOKEN }}
      run: gh release upload ${{ github.event.milestone.title }} release.yml
      
    - name: Install oci-cli
      uses: bytesbay/oci-cli-action@v1.0.2
      with:
        user: "${{ secrets.OCI_USER }}"
        fingerprint: "${{ secrets.OCI_FINGERPRINT }}"
        tenancy: "${{ secrets.OCI_TENANCY }}"
        region: "${{ secrets.OCI_REGION }}"
        api_key: |
          ${{ secrets.OCI_API_KEY }}
        
    - name: Download oci file
      run: |
        oci os object get --namespace nrxtlgtjdbvi --bucket-name CTBC_Frontend --name 119d1c1c4c94a0e1de60db756438d147692943e0.zip --file - | gh release upload ${{ github.event.milestone.title }} oci_download_file.zip --content-type application/zip
      
      #--bucket-name Dyna-CNS --name CTBC_Frontend --file '119d1c1c4c94a0e1de60db756438d147692943e0.zip'
#       run: oci os object bulk-upload -bn ${{ secrets.OCI_BUCTET_NAME }} --src-dir ./target --include '*.jar' --overwrite
